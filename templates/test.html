<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ö–µ–π—Å—ã - Standalone Test</title>
    <link rel="stylesheet" href="/static/css/style.css">
    
    <!-- Mock Telegram Web App API -->
    <script>
        // –≠–º—É–ª—è—Ü–∏—è Telegram Web App API –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.Telegram = {
            WebApp: {
                initData: '',
                initDataUnsafe: {
                    user: {
                        id: 123456789,
                        first_name: 'Test',
                        last_name: 'User',
                        username: 'testuser',
                        language_code: 'ru'
                    }
                },
                version: '6.0',
                platform: 'web',
                colorScheme: 'light',
                themeParams: {
                    bg_color: '#ffffff',
                    text_color: '#000000',
                    hint_color: '#999999',
                    link_color: '#2481cc',
                    button_color: '#2481cc',
                    button_text_color: '#ffffff'
                },
                isExpanded: true,
                viewportHeight: window.innerHeight,
                viewportStableHeight: window.innerHeight,
                
                // –ú–µ—Ç–æ–¥—ã
                ready: function() {
                    console.log('‚úÖ Telegram WebApp ready (mock)');
                },
                expand: function() {
                    console.log('üì± Telegram WebApp expanded (mock)');
                },
                close: function() {
                    console.log('‚ùå Close called (mock)');
                    alert('–í —Ä–µ–∞–ª—å–Ω–æ–º Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è');
                },
                
                // Main Button
                MainButton: {
                    text: '',
                    color: '#2481cc',
                    textColor: '#ffffff',
                    isVisible: false,
                    isActive: true,
                    isProgressVisible: false,
                    
                    setText: function(text) {
                        this.text = text;
                        console.log('MainButton text:', text);
                    },
                    show: function() {
                        this.isVisible = true;
                        console.log('MainButton shown');
                    },
                    hide: function() {
                        this.isVisible = false;
                        console.log('MainButton hidden');
                    },
                    onClick: function(callback) {
                        this._callback = callback;
                    },
                    offClick: function(callback) {
                        this._callback = null;
                    }
                },
                
                // Back Button
                BackButton: {
                    isVisible: false,
                    
                    show: function() {
                        this.isVisible = true;
                        console.log('BackButton shown');
                        this._createButton();
                    },
                    hide: function() {
                        this.isVisible = false;
                        console.log('BackButton hidden');
                        this._removeButton();
                    },
                    onClick: function(callback) {
                        this._callback = callback;
                    },
                    offClick: function(callback) {
                        this._callback = null;
                    },
                    _createButton: function() {
                        if (!document.getElementById('mock-back-btn')) {
                            const btn = document.createElement('button');
                            btn.id = 'mock-back-btn';
                            btn.textContent = '‚Üê –ù–∞–∑–∞–¥';
                            btn.style.cssText = `
                                position: fixed;
                                top: 10px;
                                left: 10px;
                                z-index: 10000;
                                background: #2481cc;
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            `;
                            btn.onclick = () => {
                                if (this._callback) this._callback();
                            };
                            document.body.appendChild(btn);
                        }
                    },
                    _removeButton: function() {
                        const btn = document.getElementById('mock-back-btn');
                        if (btn) btn.remove();
                    }
                },
                
                // Haptic Feedback
                HapticFeedback: {
                    impactOccurred: function(style) {
                        console.log('Haptic:', style);
                    },
                    notificationOccurred: function(type) {
                        console.log('Notification haptic:', type);
                    },
                    selectionChanged: function() {
                        console.log('Selection changed haptic');
                    }
                },
                
                // Alerts
                showAlert: function(message) {
                    alert(message);
                },
                showConfirm: function(message, callback) {
                    callback(confirm(message));
                },
                showPopup: function(params, callback) {
                    alert(params.message);
                    if (callback) callback();
                },
                
                // Other
                sendData: function(data) {
                    console.log('Send data to bot:', data);
                    alert('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É: ' + data);
                }
            }
        };
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç tg
        window.tg = window.Telegram.WebApp;
        
        console.log('%cüß™ Standalone Test Mode', 'background: #2481cc; color: white; padding: 5px 10px; border-radius: 3px;');
        console.log('Telegram Web App API —ç–º—É–ª–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ');
        console.log('User ID:', window.tg.initDataUnsafe.user.id);
    </script>
</head>
<body>
    <!-- –¢–µ—Å—Ç–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div id="test-panel" style="
        position: fixed;
        top: 0;
        right: 0;
        background: rgba(0,0,0,0.9);
        color: white;
        padding: 15px;
        border-bottom-left-radius: 10px;
        z-index: 9999;
        font-size: 12px;
        max-width: 300px;
    ">
        <div style="font-weight: bold; margin-bottom: 10px;">üß™ Standalone Test Mode</div>
        <div style="margin-bottom: 5px;">üë§ User ID: <span id="test-user-id">123456789</span></div>
        <div style="margin-bottom: 5px;">üí∞ Balance: <span id="test-balance">0</span> ‚≠ê</div>
        <div style="margin-top: 10px;">
            <button onclick="addTestBalance(50)" style="
                background: #00B894;
                border: none;
                color: white;
                padding: 5px 10px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 11px;
                margin-right: 5px;
            ">+50 ‚≠ê</button>
            <button onclick="addTestBalance(100)" style="
                background: #00B894;
                border: none;
                color: white;
                padding: 5px 10px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 11px;
            ">+100 ‚≠ê</button>
        </div>
        <div style="margin-top: 10px; font-size: 10px; opacity: 0.7;">
            –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ë–ï–ó Telegram
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="main-screen" class="screen active">
        <div class="header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">üë§</div>
                <div class="user-details">
                    <div class="user-name" id="userName">Test User</div>
                    <div class="user-balance">üí∞ <span id="userBalance">0</span> ‚≠ê</div>
                </div>
            </div>
            <button class="btn-topup" onclick="showTopupScreen()">
                <span>üí≥</span> –ü–æ–ø–æ–ª–Ω–∏—Ç—å
            </button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('cases')">üéÅ –ö–µ–π—Å—ã</button>
            <button class="tab" onclick="switchTab('inventory')">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="tab" onclick="switchTab('history')">üìú –ò—Å—Ç–æ—Ä–∏—è</button>
        </div>

        <div id="cases-tab" class="tab-content active">
            <div class="cases-grid" id="casesGrid">
                <!-- –ö–µ–π—Å—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <div id="inventory-tab" class="tab-content">
            <div class="inventory-list" id="inventoryList">
                <!-- –ü—Ä–µ–¥–º–µ—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <div id="history-tab" class="tab-content">
            <div class="history-header">
                <h3>üåç –ò—Å—Ç–æ—Ä–∏—è –≤—ã–∏–≥—Ä—ã—à–µ–π –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                <div class="live-indicator">üî¥ LIVE</div>
            </div>
            <div class="history-list" id="historyList">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞ -->
    <div id="opening-screen" class="screen">
        <div class="opening-header">
            <button class="btn-back" onclick="closeOpeningScreen()">‚Üê –ù–∞–∑–∞–¥</button>
            <h2 id="openingCaseName"></h2>
        </div>

        <div class="case-preview">
            <div class="case-image-container">
                <img id="openingCaseImage" src="" alt="">
            </div>
            <p class="case-description" id="openingCaseDescription"></p>
            
            <div class="case-items-preview">
                <h3>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏–∑—ã:</h3>
                <div class="items-scroll" id="caseItemsPreview"></div>
            </div>

            <div class="case-price">
                <span id="openingCasePrice"></span>
            </div>

            <button class="btn-open-case" id="btnOpenCase" onclick="confirmOpenCase()">
                <span class="btn-text">–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</span>
            </button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è -->
    <div id="animation-screen" class="screen">
        <div class="roulette-container">
            <div class="roulette-selector"></div>
            <div class="roulette-track" id="rouletteTrack"></div>
        </div>
        <div class="opening-status">–ö—Ä—É—Ç–∏–º...</div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div id="result-screen" class="screen">
        <div class="result-container">
            <h2 class="congrats">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ</h2>
            
            <div class="won-item">
                <div class="item-glow"></div>
                <img id="wonItemImage" src="" alt="">
                <div class="item-rarity" id="wonItemRarity"></div>
            </div>

            <h3 id="wonItemName"></h3>
            <div class="item-value">–¶–µ–Ω–Ω–æ—Å—Ç—å: <span id="wonItemValue"></span> ‚≠ê</div>

            <div class="result-actions">
                <button class="btn-withdraw" onclick="withdrawItem()">
                    <span>üì§</span> –í—ã–≤–µ—Å—Ç–∏ –ø—Ä–∏–∑
                </button>
                <button class="btn-continue" onclick="closeResultScreen()">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3>‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            <p id="confirmText"></p>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeConfirmModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-confirm" onclick="executeOpenCase()">–û—Ç–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Loader -->
    <div id="loader" class="loader hidden">
        <div class="spinner"></div>
    </div>

    <!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="toast" class="toast"></div>

    <!-- Test panel functions -->
    <script>
        function addTestBalance(amount) {
            const balanceEl = document.getElementById('userBalance');
            const currentBalance = parseInt(balanceEl.textContent);
            const newBalance = currentBalance + amount;
            balanceEl.textContent = newBalance;
            document.getElementById('test-balance').textContent = newBalance;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ state
            if (window.state && window.state.user) {
                window.state.user.balance = newBalance;
            }
            
            showToast(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${amount} ‚≠ê –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è`);
        }
    </script>

    <script src="/static/js/app.js"></script>
    
    <script>
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        console.log('%c‚úÖ Standalone mode –∞–∫—Ç–∏–≤–µ–Ω', 'background: #00B894; color: white; padding: 5px 10px;');
        console.log('–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤');
    </script>
</body>
</html>
