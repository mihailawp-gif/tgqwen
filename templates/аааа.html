<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="theme-color" content="#0d0d17">
    <title>–ö–µ–π—Å—ã ‚Äî Telegram</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="/static/css/style.css?v=6">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.12.2/lottie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fflate@0.8.2/umd/index.js"></script>
</head>
<body>
    <!-- ===== –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù ===== -->
    <div id="main-screen" class="screen active">
        <div class="header">
            <div class="user-section" onclick="openProfile()" style="cursor:pointer">
                <div class="user-avatar" id="userAvatar">üë§</div>
                <div class="user-info">
                    <div class="user-name" id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div class="user-balance">
                        <img src="/static/images/star.png" alt="‚≠ê" class="balance-star-icon"
                            onerror="this.style.display='none';this.nextElementSibling.style.display='inline'">
                        <span class="balance-star-fallback" style="display:none">‚≠ê</span>
                        <span id="userBalance">0</span>
                    </div>
                </div>
            </div>
            <button class="btn-topup" onclick="showTopupScreen()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
                –ü–æ–ø–æ–ª–Ω–∏—Ç—å
            </button>
        </div>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" data-tab="cases" onclick="switchTab('cases')">
                    <!-- placeholder ‚Äî –∑–∞–º–µ–Ω–∏ src –Ω–∞ —Å–≤–æ—é –∏–∫–æ–Ω–∫—É -->
                    <img src="/static/images/tab-cases.png" class="tab-icon-img"
                         onerror="this.style.opacity='0.4'" alt="">
                    <span class="tab-label">–ö–µ–π—Å—ã</span>
                </button>
                <button class="tab" data-tab="inventory" onclick="switchTab('inventory')">
                    <!-- placeholder ‚Äî –∑–∞–º–µ–Ω–∏ src –Ω–∞ —Å–≤–æ—é –∏–∫–æ–Ω–∫—É -->
                    <img src="/static/images/tab-inventory.png" class="tab-icon-img"
                         onerror="this.style.opacity='0.4'" alt="">
                    <span class="tab-label">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
                </button>
            </div>
        </div>

        <!-- –ò–°–¢–û–†–ò–Ø –í–´–ò–ì–†–´–®–ï–ô ‚Äî –≤—Å–µ–≥–¥–∞ –ø–æ–¥ —Ç–∞–±–∞–º–∏, –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª -->
        <div class="live-history-section">
            <div class="live-history-header">
                <span class="live-history-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∏–≥—Ä—ã—à–∏</span>
                <div class="live-indicator">
                    <span class="live-dot"></span>
                    <span>LIVE</span>
                </div>
            </div>
            <div class="live-history-scroll" id="liveHistoryScroll">
                <!-- –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
            </div>
        </div>

        <!-- –ö–ï–ô–°–´ -->
        <div id="cases-tab" class="tab-content active">
            <div class="cases-container">
                <div class="cases-grid" id="casesGrid"></div>
            </div>
        </div>

        <div id="inventory-tab" class="tab-content">
            <div class="inventory-container">
                <div class="inventory-grid" id="inventoryList"></div>
            </div>
        </div>

        <!-- –∏—Å—Ç–æ—Ä–∏—è –∫–∞–∫ –≤–∫–ª–∞–¥–∫–∞ –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å–∫—Ä—ã—Ç–æ–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ -->
        <div id="history-tab" class="tab-content" style="display:none">
            <div class="history-container">
                <div class="history-list" id="historyList"></div>
            </div>
        </div>
    </div>

    <!-- ===== –≠–ö–†–ê–ù –ü–†–ï–î–ü–†–û–°–ú–û–¢–†–ê ===== -->
    <div id="opening-screen" class="screen">
        <div class="preview-header">
            <button class="btn-back" onclick="closeOpeningScreen()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <h2 id="openingCaseName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–µ–π—Å–∞</h2>
        </div>

        <div class="preview-roulette-wrapper">
            <div class="preview-roulette-fade preview-roulette-fade-left"></div>
            <div class="preview-roulette-track-container">
                <div class="preview-roulette-track" id="previewRouletteTrack"></div>
            </div>
            <div class="preview-roulette-fade preview-roulette-fade-right"></div>
            <div class="preview-roulette-indicator-bottom"></div>
        </div>

        <div class="preview-scrollable">
            <p class="case-description" id="openingCaseDescription"></p>
            <div class="items-preview-section">
                <h3>–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</h3>
                <div class="preview-rewards-box">
                    <div class="preview-tiles-grid" id="caseItemsPreview"></div>
                </div>
            </div>
            <div style="display:none" id="itemsListSection">
                <div id="itemsList"></div>
            </div>
        </div>

        <div class="open-case-footer">
            <div class="case-price-display" id="openingCasePrice">
                <img src="/static/images/star.png" class="price-icon" onerror="this.outerHTML='‚≠ê'" alt="star">
                <span class="price-amount">50</span>
            </div>
            <button class="btn-open-case" id="btnOpenCase" onclick="confirmOpenCase()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
                –û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å
            </button>
        </div>
    </div>

    <!-- ===== –≠–ö–†–ê–ù –†–£–õ–ï–¢–ö–ò ===== -->
    <div id="animation-screen" class="screen">
        <div class="animation-container">
            <div class="roulette-wrapper">
                <div class="roulette-indicator"></div>
                <div class="roulette-track-container">
                    <div class="roulette-track" id="rouletteTrack"></div>
                </div>
            </div>
            <div class="opening-status">
                <div class="spinner-icon"></div>
                <span>–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–µ–π—Å...</span>
            </div>
        </div>
    </div>

    <!-- ===== –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê ===== -->
    <div id="result-screen" class="screen">
        <div class="result-container">
            <div class="result-header">
                <h2 class="congrats-text">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ</h2>
            </div>
            <div class="won-item-showcase">
                <div class="item-glow-effect"></div>
                <div class="won-item-card">
                    <img id="wonItemImage" src="" alt="–ü—Ä–∏–∑" style="display:none">
                    <div class="item-rarity-badge" id="wonItemRarity">LEGENDARY</div>
                </div>
            </div>
            <div class="won-item-details">
                <h3 id="wonItemName" class="item-name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞</h3>
                <div class="item-value">
                    <span>–¶–µ–Ω–Ω–æ—Å—Ç—å:</span>
                    <span class="value-amount">
                        <img src="/static/images/star.png" class="value-icon" onerror="this.outerHTML='‚≠ê'" alt="star">
                        <span id="wonItemValue">100</span>
                    </span>
                </div>
            </div>
            <div class="result-actions">
                <button class="btn-action btn-sell-result" onclick="sellResultItem()">
                    –ü—Ä–æ–¥–∞—Ç—å –∑–∞ <span id="resultSellPrice">0</span> <img src="/static/images/star.png" class="btn-sell-star-icon" alt="star">
                </button>
                <div id="starsAutoNotice" style="display:none;align-items:center;justify-content:center;gap:6px;padding:12px 16px;background:linear-gradient(135deg,rgba(255,200,0,.15),rgba(255,150,0,.1));border:1px solid rgba(255,200,0,.3);border-radius:14px;font-size:13px;font-weight:700;color:#ffd700;">
                    <img src="/static/images/star.png" style="width:18px;height:18px" alt="‚≠ê"> –ó–≤—ë–∑–¥—ã –∑–∞—á–∏—Å–ª–µ–Ω—ã –Ω–∞ –±–∞–ª–∞–Ω—Å!
                </div>
                <button class="btn-action btn-continue" onclick="closeResultScreen()">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- ===== –ú–û–î–ê–õ–ö–ê –ü–û–ü–û–õ–ù–ï–ù–ò–Ø ===== -->
    <div id="topupModal" class="modal">
        <div class="modal-overlay" onclick="closeTopupModal()"></div>
        <div class="modal-content topup-modal">
            <div class="modal-handle"></div>
            <div class="modal-header">
                <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
                <button class="btn-close" onclick="closeTopupModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="payment-options">
                <div class="payment-header">
                    <img src="/static/images/star.png" class="stars-icon-large"
                        onerror="this.outerHTML='<div style=\'font-size:48px\'>‚≠ê</div>'" alt="star">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—ë–∑–¥</p>
                </div>
                <div class="amounts-grid" id="topupAmounts">
                    <button class="amount-card" onclick="createStarsInvoice(200)"><div class="amount-stars"><img src="/static/images/star.png" class="amount-star-icon" onerror="this.outerHTML='‚≠ê'" alt="star"> 200</div></button>
                    <button class="amount-card" onclick="createStarsInvoice(500)"><div class="amount-stars"><img src="/static/images/star.png" class="amount-star-icon" onerror="this.outerHTML='‚≠ê'" alt="star"> 500</div></button>
                    <button class="amount-card" onclick="createStarsInvoice(1000)"><div class="amount-stars"><img src="/static/images/star.png" class="amount-star-icon" onerror="this.outerHTML='‚≠ê'" alt="star"> 1000</div></button>
                    <button class="amount-card" onclick="createStarsInvoice(2500)"><div class="amount-stars"><img src="/static/images/star.png" class="amount-star-icon" onerror="this.outerHTML='‚≠ê'" alt="star"> 2500</div></button>
                    <button class="amount-card" onclick="createStarsInvoice(5000)"><div class="amount-stars"><img src="/static/images/star.png" class="amount-star-icon" onerror="this.outerHTML='‚≠ê'" alt="star"> 5000</div></button>
                    <button class="amount-card" onclick="createStarsInvoice(10000)"><div class="amount-stars"><img src="/static/images/star.png" class="amount-star-icon" onerror="this.outerHTML='‚≠ê'" alt="star"> 10000</div></button>
                </div>
                
                <!-- –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Å–≤–æ–µ–π —Å—É–º–º—ã -->
                <div class="custom-amount-section">
                    <p class="custom-amount-label">–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é —Å—É–º–º—É:</p>
                    <div class="custom-amount-input">
                        <input type="number" id="customStarsAmount" placeholder="–ú–∏–Ω. 1" min="1" max="100000" value="100">
                        <button class="btn-custom-amount" onclick="createCustomStarsInvoice()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== –ú–û–î–ê–õ–ö–ê –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø ===== -->
    <div id="confirmModal" class="modal">
        <div class="modal-overlay" onclick="closeConfirmModal()"></div>
        <div class="modal-content confirm-modal">
            <div class="modal-handle"></div>
            <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            <p id="confirmText"></p>
            <div class="modal-actions">
                <button class="btn-modal btn-cancel" onclick="closeConfirmModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-modal btn-confirm" onclick="executeOpenCase()">–û—Ç–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="loader" class="loader hidden"><div class="loader-spinner"></div></div>
    <div id="toast" class="toast"></div>

    <!-- ===== –≠–ö–†–ê–ù –ü–†–û–§–ò–õ–Ø ===== -->
    <div id="profile-screen" class="screen">
        <div class="profile-header">
            <button class="btn-back" onclick="closeProfile()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
        </div>
        
        <div class="profile-content">
            <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ –∏ –∏–º—è -->
            <div class="profile-avatar-section">
                <div class="profile-avatar" id="profileAvatar">üë§</div>
                <h3 id="profileName">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <div class="profile-username" id="profileUsername">@username</div>
            </div>
            
            <!-- –ë–∞–ª–∞–Ω—Å -->
            <div class="profile-balance-card">
                <div class="balance-label">–ë–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount">
                    <img src="/static/images/star.png" class="profile-star-icon" alt="star">
                    <span id="profileBalance">0</span>
                </div>
            </div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="profile-stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="profileOpenings">0</div>
                    <div class="stat-label">–û—Ç–∫—Ä—ã—Ç–æ –∫–µ–π—Å–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="profileReferrals">0</div>
                    <div class="stat-label">–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="profileEarnings">0</div>
                    <div class="stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ ‚≠ê</div>
                </div>
            </div>
            
            <!-- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ -->
            <div class="referral-section">
                <h4>–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</h4>
                <p class="referral-description">–ü–æ–ª—É—á–∞–π 5% —Å –∫–∞–∂–¥–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞ —Ç–≤–æ–∏–º–∏ –¥—Ä—É–∑—å—è–º–∏!</p>
                
                <div class="referral-link-box">
                    <div class="referral-code" id="referralCode">CODE</div>
                    <button class="btn-copy" onclick="copyReferralLink()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
                <p class="referral-hint">–ù–∞–∂–º–∏ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</p>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="profile-actions">
                <button class="btn-profile-action" onclick="showReferralsList()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    –ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã
                </button>
                <button class="btn-profile-action" onclick="showEarningsHistory()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    –ò—Å—Ç–æ—Ä–∏—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞
                </button>
            </div>
        </div>
    </div>

    <!-- ===== –ú–û–î–ê–õ–ö–ê –†–ï–§–ï–†–ê–õ–û–í ===== -->
    <div id="referralsModal" class="modal">
        <div class="modal-overlay" onclick="closeReferralsModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</h3>
                <button class="btn-close" onclick="closeReferralsModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="referrals-list" id="referralsList">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
            </div>
        </div>
    </div>

    <!-- ===== –ú–û–î–ê–õ–ö–ê –ò–°–¢–û–†–ò–ò –ó–ê–†–ê–ë–û–¢–ö–ê ===== -->
    <div id="earningsModal" class="modal">
        <div class="modal-overlay" onclick="closeEarningsModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ò—Å—Ç–æ—Ä–∏—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞</h3>
                <button class="btn-close" onclick="closeEarningsModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="earnings-list" id="earningsList">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
            </div>
        </div>
    </div>

    <script src="/static/js/tgs-manager.js?v=11"></script>
    <script src="/static/js/app.js?v=11"></script>
</body>
</html>
